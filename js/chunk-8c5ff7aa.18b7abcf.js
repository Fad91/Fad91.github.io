(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-8c5ff7aa"],{"0525":function(e,t,a){},"06c5":function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));a("fb6a"),a("d3b7"),a("b0c0"),a("a630"),a("3ca3");var r=a("6b75");function i(e,t){if(e){if("string"===typeof e)return Object(r["a"])(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?Object(r["a"])(e,t):void 0}}},"272c":function(e,t,a){},3254:function(e,t,a){},3368:function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("AppPopupWrapper",{attrs:{hidden:e.hidePopupStatus}},[a("AppTopPanel",{attrs:{header:e.header},scopedSlots:e._u([{key:"nav-buttons",fn:function(){return[a("AppButtonIcon",{attrs:{icon:"delete",size:"1.8rem",title:"Удалить"},on:{"button-click":function(t){return e.$emit("delete-element")}}}),a("AppButtonIcon",{attrs:{icon:"close",size:"1.8rem",title:"Закрыть"},on:{"button-click":function(t){return e.$emit("close-popup")}}})]},proxy:!0}])}),a("div",{staticClass:"popup-delete-wrapper"},[a("p",[e._t("popup-delete-content")],2)])],1)},i=[],n=a("a26a"),o=a("34b0"),s=a("373c"),d={name:"PopupDeleteWrapper",components:{AppPopupWrapper:n["a"],AppTopPanel:o["a"],AppButtonIcon:s["a"]},props:{hidePopupStatus:Boolean,header:String}},c=d,l=(a("93f4"),a("2877")),u=Object(l["a"])(c,r,i,!1,null,"18d3d347",null);t["a"]=u.exports},"4b15":function(e,t,a){"use strict";a("4ce5")},"4ce5":function(e,t,a){},"4df4":function(e,t,a){"use strict";var r=a("0366"),i=a("7b0b"),n=a("9bdd"),o=a("e95a"),s=a("50c4"),d=a("8418"),c=a("35a1");e.exports=function(e){var t,a,l,u,p,h,f=i(e),D="function"==typeof this?this:Array,v=arguments.length,S=v>1?arguments[1]:void 0,m=void 0!==S,k=c(f),E=0;if(m&&(S=r(S,v>2?arguments[2]:void 0,2)),void 0==k||D==Array&&o(k))for(t=s(f.length),a=new D(t);t>E;E++)h=m?S(f[E],E):f[E],d(a,E,h);else for(u=k.call(f),p=u.next,a=new D;!(l=p.call(u)).done;E++)h=m?n(u,S,[l.value,E],!0):l.value,d(a,E,h);return a.length=E,a}},"5afc":function(e,t,a){"use strict";a("272c")},"6b75":function(e,t,a){"use strict";function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}a.d(t,"a",(function(){return r}))},"787e":function(e,t,a){"use strict";a("0525")},7980:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app-edit"}},[a("PopupDeleteWrapper",{attrs:{hidePopupStatus:e.popupRemoveHidden,header:"Удаление заявки "+e.editedDeal.name},on:{"close-popup":e.popupRemoveToggle,"delete-element":function(t){return e.removeDeal(e.editedDeal)}},scopedSlots:e._u([{key:"popup-delete-content",fn:function(){return[e._v(" После нажатия на иконку корзины будет удалёна заявка "),a("b",[e._v(e._s(e.editedDeal.name))])]},proxy:!0}])}),a("AppEditWrapper",{attrs:{header:"Редактор заявки: "+e.editedDeal.name},scopedSlots:e._u([{key:"nav-buttons",fn:function(){return[a("AppButtonIcon",{attrs:{icon:"save",size:"1.8rem",title:"Сохранить и выйти"},on:{"button-click":function(t){return e.saveEditedDeal(e.editedDeal)}}}),a("AppButtonIcon",{attrs:{icon:"",size:"1.8rem"}}),a("AppButtonIcon",{attrs:{icon:"delete",size:"1.8rem",title:"Удалить"},on:{"button-click":e.popupRemoveToggle}}),a("AppButtonIcon",{attrs:{icon:"description",title:"История",size:"1.8rem"},on:{"button-click":function(t){return e.$router.push({name:"dealHistory",params:{id:e.editedDeal.id}})}}}),a("AppButtonIcon",{attrs:{icon:"attach_money",size:"1.8rem",title:"Вернуться"},on:{"button-click":e.editorExit}})]},proxy:!0},{key:"edit-section",fn:function(){return[a("div",{staticClass:"edit-block"},[a("AppHeaderIcon",{staticClass:"edit-block-header",attrs:{"header-level":"4","material-icon":"import_contacts","header-text":"Основные данные"}}),a("div",{staticClass:"edit-block-content"},[a("AppLineText",{attrs:{inputID:"input-city",label:"Название: ",maxLength:"20"},model:{value:e.editedDeal.name,callback:function(t){e.$set(e.editedDeal,"name",t)},expression:"editedDeal.name"}}),a("AppSelect",{attrs:{selectID:"select",label:"Заказчик: "},model:{value:e.customerID,callback:function(t){e.customerID=t},expression:"customerID"}},e._l(e.customers,(function(t){return a("option",{key:t.id,domProps:{value:t.id}},[e._v(e._s(t.name))])})),0)],1)],1),a("div",{staticClass:"edit-block"},[a("AppHeaderIcon",{staticClass:"edit-block-header",attrs:{"header-level":"4","material-icon":"date_range","header-text":"Даты"}}),a("div",{staticClass:"edit-block-content"},[a("AppLineDate",{attrs:{dateID:"input-deal-date-start",label:"Начало: "},model:{value:e.dateStart,callback:function(t){e.dateStart=t},expression:"dateStart"}}),a("AppLineDate",{attrs:{dateID:"input-deal-date-end",label:"Конец: "},model:{value:e.dateEnd,callback:function(t){e.dateEnd=t},expression:"dateEnd"}})],1)],1),a("div",{staticClass:"edit-block"},[a("AppHeaderIcon",{staticClass:"edit-block-header",attrs:{"header-level":"4","material-icon":"transfer_within_a_station","header-text":"Рабочие"}}),a("div",{staticClass:"edit-block-content"},e._l(e.workersCount,(function(t){return a("div",{key:t},[a("AppSelect",{attrs:{selectID:"select",label:"Рабочий "+t+": ",value:e.elementCountNumber(t),count:t},on:{"select-change":e.pushMoreWorkers}},[a("option",{attrs:{value:""}},[e._v("Никого")]),e._l(e.localWorkers,(function(t){return a("option",{key:t.id,domProps:{value:t.id}},[e._v(e._s(t.surname)+" "+e._s(t.name))])}))],2)],1)})),0),a("p",{staticClass:"button-add",on:{click:function(t){return e.addMoreWorkers()}}},[e._v("Добавить ещё одного рабочего")])],1),a("div",{staticClass:"edit-block"},[a("AppHeaderIcon",{staticClass:"edit-block-header",attrs:{"header-level":"4","material-icon":"chrome_reader_mode","header-text":"Заметки"}}),a("div",{staticClass:"edit-block-content"},[a("AppNumbers",{attrs:{inputID:"input-note-count",label:"Заметок в списке:  ",minValue:"0",maxValue:"35",maxLength:"3"},model:{value:e.editedDeal.notesCount,callback:function(t){e.$set(e.editedDeal,"notesCount",t)},expression:"editedDeal.notesCount"}}),a("AppLineText",{attrs:{placeholder:"Введите новую заметку",inputID:"input-note",label:"Новая Заметка: ",maxLength:"35"},model:{value:e.note,callback:function(t){e.note=t},expression:"note"}}),a("AppNotesList",{attrs:{"notes-list":e.editedDeal.notes,"notes-count":e.editedDeal.notesCount}})],1)],1)]},proxy:!0}])})],1)},i=[],n=a("b85c"),o=a("5530"),s=(a("99af"),a("4de4"),a("b0c0"),a("260b")),d=a("2f62"),c=a("2721"),l=a("38a1"),u=a("c0a7"),p=a("1b06"),h=a("49a1"),f=a("373c"),D=a("3368"),v=a("fac1"),S=a("7c82"),m={name:"DealEdit",components:{AppEditWrapper:c["a"],AppHeaderIcon:l["a"],AppButtonIcon:f["a"],AppLineText:p["a"],AppNumbers:h["a"],AppSelect:v["a"],AppLineDate:S["a"],AppNotesList:u["a"],PopupDeleteWrapper:D["a"]},data:function(){return{popupRemoveHidden:!0,editedDeal:"",note:"",customerID:"",worker1ID:"",worker2ID:"",worker3ID:"",worker4ID:"",worker5ID:"",dateStart:"",dateEnd:"",localWorkers:"",workersCount:0,addedWorkers:{},historyElement:{date:"[Дата: ".concat((new Date).toLocaleDateString()," Время: ").concat((new Date).toLocaleTimeString(),"]"),info:"Заявка просматривалась ",employee:{name:"Неизвестный пользователь",id:0}}}},computed:Object(o["a"])({},Object(d["c"])(["deals","employees","authEmployee","workers","customers"])),watch:{dateStart:function(){this.editedDeal.dateStart=this.dateStart,this.checkWorkers()},dateEnd:function(){this.editedDeal.dateEnd=this.dateEnd,this.checkWorkers()}},created:function(){this.SET_EMPLOYEES_FROM_LOCAL_STORAGE(),this.SET_DEALS_FROM_LOCAL_STORAGE(),this.SET_WORKERS_FROM_LOCAL_STORAGE(),this.SET_CUSTOMERS_FROM_LOCAL_STORAGE(),this.editedDeal=this.deals[this.$route.params.id],this.customerID=this.editedDeal.customer.id,this.dateStart=this.editedDeal.dateStart,this.dateEnd=this.editedDeal.dateEnd,this.addedWorkers=this.editedDeal.workers,this.workersCount=this.addedWorkers.length;try{this.worker1ID=this.editedDeal.worker.id}catch(e){}try{this.worker2ID=this.editedDeal.worker2.id}catch(e){}try{this.worker3ID=this.editedDeal.worker3.id}catch(e){}try{this.worker4ID=this.editedDeal.worker4.id}catch(e){}try{this.worker5ID=this.editedDeal.worker5.id}catch(e){}this.checkWorkers(),console.log(0,this.addedWorkers)},methods:Object(o["a"])(Object(o["a"])({},Object(d["d"])(["SET_DEALS_FROM_SERVER","SET_DEALS_FROM_LOCAL_STORAGE","SET_EMPLOYEES_FROM_LOCAL_STORAGE","SET_WORKERS_FROM_LOCAL_STORAGE","SET_CUSTOMERS_FROM_LOCAL_STORAGE","SET_CUSTOMERS_FROM_SERVER","SET_WORKERS_FROM_SERVER"])),{},{elementCountNumber:function(e){var t,a=0,r=Object(n["a"])(this.addedWorkers);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(a++,a===e)return i}}catch(o){r.e(o)}finally{r.f()}},addMoreWorkers:function(){this.workersCount++,this.checkWorkers()},pushMoreWorkers:function(e,t){console.log(t),this.addedWorkers[t-1]=e,console.log(2,this.addedWorkers)},checkWorkers:function(){for(var e in this.localWorkers=Object(o["a"])({},this.workers),this.localWorkers)"Да"===this.localWorkers[e].fired&&delete this.localWorkers[e];if(""!==this.dateStart)try{for(var t in this.localWorkers){var a,r=Object(n["a"])(this.localWorkers[t].events);try{for(r.s();!(a=r.n()).done;){var i=a.value;void 0!==this.localWorkers[t]&&i.start<this.dateStart&&i.dealID!==this.editedDeal.id&&delete this.localWorkers[t]}}catch(u){r.e(u)}finally{r.f()}}}catch(p){}if(""!==this.dateEnd)try{for(var s in this.localWorkers){var d,c=Object(n["a"])(this.localWorkers[s].events);try{for(c.s();!(d=c.n()).done;){var l=d.value;void 0!==this.localWorkers[s]&&l.end<this.dateEnd&&l.dealID!==this.editedDeal.id&&delete this.localWorkers[s]}}catch(u){c.e(u)}finally{c.f()}}}catch(p){}},popupRemoveToggle:function(){this.popupRemoveHidden=!this.popupRemoveHidden},removeDeal:function(e){var t=this;this.popupRemoveToggle(),this.editorExit(),s["a"].database().ref("/deals/"+e.id).remove().then((function(){console.log("Заявка удалёна 🗑️"),t.SET_DEALS_FROM_SERVER()}))},editorExit:function(){this.$router.push("/deals")},saveNewNote:function(){if(this.note.length)try{this.editedDeal.notes.push("".concat((new Date).toLocaleDateString(),": ").concat(this.note))}catch(e){this.editedDeal.notes=[],this.editedDeal.notes.push("".concat((new Date).toLocaleDateString(),": ").concat(this.note))}},getNewHistoryElement:function(e){var t=this.historyElement;return t.info=e,t},saveEditedDeal:function(e){var t=this;if(this.saveNewNote(),""!==this.customerID){var a=this.customers;a[this.editedDeal.customer.id].dealStatistics=a[this.editedDeal.customer.id].dealStatistics.filter((function(e){return e.dealID!==t.editedDeal.id})),a[this.customerID].dealStatistics.push({name:this.editedDeal.name,dateStart:this.editedDeal.dateStart,dateEnd:this.editedDeal.dateEnd,dealID:this.editedDeal.id}),s["a"].database().ref("/customers/").set(a).then((function(){t.SET_CUSTOMERS_FROM_SERVER()})),this.editedDeal.customer=this.customers[this.customerID]}if(""!==this.worker1ID){try{var r=this.deals[[this.editedDeal.id]].worker.id,i=this.workers[r];i.dealStatistics=i.dealStatistics.filter((function(e){return e.dealID!==t.editedDeal.id})),i.events=i.events.filter((function(e){return e.dealID!==t.editedDeal.id})),s["a"].database().ref("/workers/"+i.id).set(i).then((function(){t.SET_WORKERS_FROM_SERVER()}))}catch(k){}var n=this.workers[this.worker1ID];n.dealStatistics.push({name:e.name,customer:e.customer,dateStart:e.dateStart,dateEnd:e.dateEnd,dealID:e.id}),n.events.push({id:Date.now(),title:e.name,start:e.dateStart,end:e.dateEnd,dealID:e.id}),s["a"].database().ref("/workers/"+n.id).set(n).then((function(){t.SET_WORKERS_FROM_SERVER()})),this.editedDeal.worker=this.workers[this.worker1ID]}if(""!==this.worker2ID){try{var o=this.deals[[this.editedDeal.id]].worker2.id,d=this.workers[o];d.dealStatistics=d.dealStatistics.filter((function(e){return e.dealID!==t.editedDeal.id})),d.events=d.events.filter((function(e){return e.dealID!==t.editedDeal.id})),s["a"].database().ref("/workers/"+d.id).set(d).then((function(){t.SET_WORKERS_FROM_SERVER()}))}catch(k){}var c=this.workers[this.worker2ID];c.dealStatistics.push({name:e.name,customer:e.customer,dateStart:e.dateStart,dateEnd:e.dateEnd,dealID:e.id}),c.events.push({id:Date.now(),title:e.name,start:e.dateStart,end:e.dateEnd,dealID:e.id}),s["a"].database().ref("/workers/"+c.id).set(c).then((function(){t.SET_WORKERS_FROM_SERVER()})),this.editedDeal.worker2=this.workers[this.worker2ID]}if(""!==this.worker3ID){try{var l=this.deals[[this.editedDeal.id]].worker3.id,u=this.workers[l];u.dealStatistics=u.dealStatistics.filter((function(e){return e.dealID!==t.editedDeal.id})),u.events=u.events.filter((function(e){return e.dealID!==t.editedDeal.id})),s["a"].database().ref("/workers/"+u.id).set(u).then((function(){t.SET_WORKERS_FROM_SERVER()}))}catch(k){}var p=this.workers[this.worker3ID];p.dealStatistics.push({name:e.name,customer:e.customer,dateStart:e.dateStart,dateEnd:e.dateEnd,dealID:e.id}),p.events.push({id:Date.now(),title:e.name,start:e.dateStart,end:e.dateEnd,dealID:e.id}),s["a"].database().ref("/workers/"+p.id).set(p).then((function(){t.SET_WORKERS_FROM_SERVER()})),this.editedDeal.worker3=this.workers[this.worker3ID]}if(""!==this.worker4ID){try{var h=this.deals[[this.editedDeal.id]].worker4.id,f=this.workers[h];f.dealStatistics=f.dealStatistics.filter((function(e){return e.dealID!==t.editedDeal.id})),f.events=f.events.filter((function(e){return e.dealID!==t.editedDeal.id})),s["a"].database().ref("/workers/"+f.id).set(f).then((function(){t.SET_WORKERS_FROM_SERVER()}))}catch(k){}var D=this.workers[this.worker4ID];D.dealStatistics.push({name:e.name,customer:e.customer,dateStart:e.dateStart,dateEnd:e.dateEnd,dealID:e.id}),D.events.push({id:Date.now(),title:e.name,start:e.dateStart,end:e.dateEnd,dealID:e.id}),s["a"].database().ref("/workers/"+D.id).set(D).then((function(){t.SET_WORKERS_FROM_SERVER()})),this.editedDeal.worker4=this.workers[this.worker4ID]}if(""!==this.worker5ID){try{var v=this.deals[[this.editedDeal.id]].worker5.id,S=this.workers[v];S.dealStatistics=S.dealStatistics.filter((function(e){return e.dealID!==t.editedDeal.id})),S.events=S.events.filter((function(e){return e.dealID!==t.editedDeal.id})),s["a"].database().ref("/workers/"+S.id).set(S).then((function(){t.SET_WORKERS_FROM_SERVER()}))}catch(k){}var m=this.workers[this.worker5ID];m.dealStatistics.push({name:e.name,customer:e.customer,dateStart:e.dateStart,dateEnd:e.dateEnd,dealID:e.id}),m.events.push({id:Date.now(),title:e.name,start:e.dateStart,end:e.dateEnd,dealID:e.id}),s["a"].database().ref("/workers/"+m.id).set(m).then((function(){t.SET_WORKERS_FROM_SERVER()})),this.editedDeal.worker5=this.workers[this.worker5ID]}e.history.push(this.getNewHistoryElement("Заявка была изменена")),s["a"].database().ref("/deals/"+e.id).set(e).then((function(){t.SET_DEALS_FROM_SERVER(),t.editorExit(),M.toast({html:"Данные сохранены!"})}))}})},k=m,E=(a("5afc"),a("2877")),b=Object(E["a"])(k,r,i,!1,null,"6a9835ce",null);t["default"]=b.exports},"7c82":function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"container-line-date"}},[a("input",{staticClass:"line-date",attrs:{type:"datetime-local",id:e.dateID,placeholder:e.placeholder},domProps:{value:e.value},on:{input:function(t){return e.$emit("input",t.target.value)}}}),a("label",{staticClass:"line-date-label",attrs:{for:e.dateID}},[e._v(e._s(e.label))])])},i=[],n={name:"AppLineDate",props:{dateID:String,placeholder:String,label:String,value:String}},o=n,s=(a("ef11"),a("2877")),d=Object(s["a"])(o,r,i,!1,null,"32745002",null);t["a"]=d.exports},"93f4":function(e,t,a){"use strict";a("e420")},a26a:function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{class:e.hidden?"hidden":"",attrs:{id:"app-popup-wrapper"}},[a("div",{staticClass:"popup-wrapper-overlay"},[a("div",{staticClass:"popup-wrapper-content"},[e._t("default")],2)])])},i=[],n={name:"PopupWrapper",props:{hidden:Boolean}},o=n,s=(a("4b15"),a("2877")),d=Object(s["a"])(o,r,i,!1,null,"fa5ad10c",null);t["a"]=d.exports},a630:function(e,t,a){var r=a("23e7"),i=a("4df4"),n=a("1c7e"),o=!n((function(e){Array.from(e)}));r({target:"Array",stat:!0,forced:o},{from:i})},b0c0:function(e,t,a){var r=a("83ab"),i=a("9bf2").f,n=Function.prototype,o=n.toString,s=/^\s*function ([^ (]*)/,d="name";r&&!(d in n)&&i(n,d,{configurable:!0,get:function(){try{return o.call(this).match(s)[1]}catch(e){return""}}})},b85c:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));a("a4d3"),a("e01a"),a("d3b7"),a("d28b"),a("3ca3"),a("ddb0");var r=a("06c5");function i(e,t){var a="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=Object(r["a"])(e))||t&&e&&"number"===typeof e.length){a&&(e=a);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,d=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return s=e.done,e},e:function(e){d=!0,o=e},f:function(){try{s||null==a["return"]||a["return"]()}finally{if(d)throw o}}}}},d28b:function(e,t,a){var r=a("746f");r("iterator")},e01a:function(e,t,a){"use strict";var r=a("23e7"),i=a("83ab"),n=a("da84"),o=a("5135"),s=a("861d"),d=a("9bf2").f,c=a("e893"),l=n.Symbol;if(i&&"function"==typeof l&&(!("description"in l.prototype)||void 0!==l().description)){var u={},p=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),t=this instanceof p?new l(e):void 0===e?l():l(e);return""===e&&(u[t]=!0),t};c(p,l);var h=p.prototype=l.prototype;h.constructor=p;var f=h.toString,D="Symbol(test)"==String(l("test")),v=/^Symbol\((.*)\)[^)]+$/;d(h,"description",{configurable:!0,get:function(){var e=s(this)?this.valueOf():this,t=f.call(e);if(o(u,e))return"";var a=D?t.slice(7,-1):t.replace(v,"$1");return""===a?void 0:a}}),r({global:!0,forced:!0},{Symbol:p})}},e420:function(e,t,a){},ef11:function(e,t,a){"use strict";a("3254")},fac1:function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"container-select"}},[a("select",{staticClass:"app-select browser-default",attrs:{id:e.selectID},domProps:{value:e.value},on:{input:function(t){return e.$emit("input",t.target.value)},change:function(t){return e.$emit("select-change",t.target.value,e.count)}}},[e._t("default")],2),a("label",{staticClass:"select-label",attrs:{for:e.selectID}},[e._v(e._s(e.label))])])},i=[],n=(a("a9e3"),{name:"AppSelect",props:{selectID:String,label:String,value:String|Number,count:Number}}),o=n,s=(a("787e"),a("2877")),d=Object(s["a"])(o,r,i,!1,null,"bbf6f81a",null);t["a"]=d.exports}}]);
//# sourceMappingURL=chunk-8c5ff7aa.18b7abcf.js.map