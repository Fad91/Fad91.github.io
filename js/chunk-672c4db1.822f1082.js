(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-672c4db1"],{"005d":function(e,t,a){},"0525":function(e,t,a){},"06c5":function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));a("fb6a"),a("d3b7"),a("b0c0"),a("a630"),a("3ca3");var r=a("6b75");function i(e,t){if(e){if("string"===typeof e)return Object(r["a"])(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?Object(r["a"])(e,t):void 0}}},"1c6a":function(e,t,a){},3254:function(e,t,a){},"49a1":function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"container-app-numbers"}},[a("input",{staticClass:"app-numbers",attrs:{type:"number",id:e.inputID,placeholder:e.placeholder,min:e.minValue,max:e.maxValue,maxlength:e.maxLength},domProps:{value:e.value},on:{input:function(t){return e.numbersValueSubmit(t.target.value)}}}),a("label",{staticClass:"app-numbers-label",attrs:{for:e.inputID}},[e._v(e._s(e.label))])])},i=[],n=(a("a9e3"),{name:"AppNumbers",props:{inputID:String,placeholder:String,label:String,value:String,minValue:String,maxValue:String,maxLength:String},methods:{numbersValueSubmit:function(e){var t=String(e);Number(e)>Number(this.$props.maxValue)&&(t=this.$props.maxValue,this.$forceUpdate()),Number(this.$props.minValue)>Number(e)&&(t=this.$props.minValue,this.$forceUpdate()),""===e&&(t="0"),this.$emit("input",t)}}}),s=n,o=(a("4fda"),a("2877")),d=Object(o["a"])(s,r,i,!1,null,"a1d1ccbc",null);t["a"]=d.exports},"4df4":function(e,t,a){"use strict";var r=a("0366"),i=a("7b0b"),n=a("9bdd"),s=a("e95a"),o=a("50c4"),d=a("8418"),l=a("35a1");e.exports=function(e){var t,a,c,u,h,p,f=i(e),m="function"==typeof this?this:Array,D=arguments.length,S=D>1?arguments[1]:void 0,v=void 0!==S,b=l(f),k=0;if(v&&(S=r(S,D>2?arguments[2]:void 0,2)),void 0==b||m==Array&&s(b))for(t=o(f.length),a=new m(t);t>k;k++)p=v?S(f[k],k):f[k],d(a,k,p);else for(u=b.call(f),h=u.next,a=new m;!(c=h.call(u)).done;k++)p=v?n(u,S,[c.value,k],!0):c.value,d(a,k,p);return a.length=k,a}},"4fda":function(e,t,a){"use strict";a("1c6a")},"6b75":function(e,t,a){"use strict";function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}a.d(t,"a",(function(){return r}))},"787e":function(e,t,a){"use strict";a("0525")},7980:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app-edit"}},[a("PopupDeleteWrapper",{attrs:{hidePopupStatus:e.popupRemoveHidden,header:"Удаление заявки "+e.editedDeal.name},on:{"close-popup":e.popupRemoveToggle,"delete-element":function(t){return e.removeDeal(e.editedDeal)}},scopedSlots:e._u([{key:"popup-delete-content",fn:function(){return[e._v(" После нажатия на иконку корзины будет удалёна заявка "),a("b",[e._v(e._s(e.editedDeal.name))])]},proxy:!0}])}),a("AppEditWrapper",{attrs:{header:"Редактор заявки: "+e.editedDeal.name},scopedSlots:e._u([{key:"nav-buttons",fn:function(){return[a("AppButtonIcon",{attrs:{icon:"save",size:"1.8rem",title:"Сохранить и выйти"},on:{"button-click":function(t){return e.saveEditedDeal(e.editedDeal)}}}),a("AppButtonIcon",{attrs:{icon:"",size:"1.8rem"}}),a("AppButtonIcon",{attrs:{icon:"delete",size:"1.8rem",title:"Удалить"},on:{"button-click":e.popupRemoveToggle}}),a("AppButtonIcon",{attrs:{icon:"description",title:"История",size:"1.8rem"},on:{"button-click":function(t){return e.$router.push({name:"dealHistory",params:{id:e.editedDeal.id}})}}}),a("AppButtonIcon",{attrs:{icon:"attach_money",size:"1.8rem",title:"Вернуться"},on:{"button-click":e.editorExit}})]},proxy:!0},{key:"edit-section",fn:function(){return[a("div",{staticClass:"edit-block"},[a("AppHeaderIcon",{staticClass:"edit-block-header",attrs:{"header-level":"4","material-icon":"import_contacts","header-text":"Основные данные"}}),a("div",{staticClass:"edit-block-content"},[a("AppLineText",{attrs:{inputID:"input-city",label:"Название: ",maxLength:"20"},model:{value:e.editedDeal.name,callback:function(t){e.$set(e.editedDeal,"name",t)},expression:"editedDeal.name"}}),a("AppSelect",{attrs:{selectID:"select",label:"Заказчик: "},model:{value:e.customerID,callback:function(t){e.customerID=t},expression:"customerID"}},e._l(e.customers,(function(t){return a("option",{key:t.id,domProps:{value:t.id}},[e._v(e._s(t.name))])})),0),a("AppLineText",{attrs:{inputID:"input-city",label:"Подразделение: ",maxLength:"20"},model:{value:e.editedDeal.customer.subdivision,callback:function(t){e.$set(e.editedDeal.customer,"subdivision",t)},expression:"editedDeal.customer.subdivision"}}),a("AppLineText",{attrs:{inputID:"input-needed-count",label:"Кол-во рабочих: ",maxLength:"20"},model:{value:e.editedDeal.neededWorkersCount,callback:function(t){e.$set(e.editedDeal,"neededWorkersCount",t)},expression:"editedDeal.neededWorkersCount"}})],1)],1),a("div",{staticClass:"edit-block"},[a("AppHeaderIcon",{staticClass:"edit-block-header",attrs:{"header-level":"4","material-icon":"date_range","header-text":"Даты"}}),a("div",{staticClass:"edit-block-content"},[a("AppLineDate",{attrs:{dateID:"input-deal-date-start",label:"Начало: "},model:{value:e.dateStart,callback:function(t){e.dateStart=t},expression:"dateStart"}}),a("AppLineDate",{attrs:{dateID:"input-deal-date-end",label:"Конец: "},model:{value:e.dateEnd,callback:function(t){e.dateEnd=t},expression:"dateEnd"}})],1)],1),a("div",{staticClass:"edit-block"},[a("AppHeaderIcon",{staticClass:"edit-block-header",attrs:{"header-level":"4","material-icon":"transfer_within_a_station","header-text":"Рабочие"}}),a("div",{staticClass:"edit-block-content"},e._l(e.workersCount,(function(t){return a("div",{key:t},[a("AppSelect",{attrs:{selectID:"select",label:"Рабочий "+t+": ",value:e.elementCountNumber(t),count:t},on:{"select-change":e.pushMoreWorkers}},[a("option",{attrs:{value:""}},[e._v("Никого")]),e._l(e.localWorkers,(function(t){return a("option",{key:t.id,domProps:{value:t.id}},[e._v(e._s(t.surname)+" "+e._s(t.name))])}))],2)],1)})),0),a("p",{staticClass:"button-add",on:{click:function(t){return e.addMoreWorkers()}}},[e._v("Добавить ещё одного рабочего")])],1),a("div",{staticClass:"edit-block"},[a("AppHeaderIcon",{staticClass:"edit-block-header",attrs:{"header-level":"4","material-icon":"chrome_reader_mode","header-text":"Заметки"}}),a("div",{staticClass:"edit-block-content"},[a("AppNumbers",{attrs:{inputID:"input-note-count",label:"Заметок в списке:  ",minValue:"0",maxValue:"35",maxLength:"3"},model:{value:e.editedDeal.notesCount,callback:function(t){e.$set(e.editedDeal,"notesCount",t)},expression:"editedDeal.notesCount"}}),a("AppLineText",{attrs:{placeholder:"Введите новую заметку",inputID:"input-note",label:"Новая Заметка: ",maxLength:"35"},model:{value:e.note,callback:function(t){e.note=t},expression:"note"}}),a("AppNotesList",{attrs:{"notes-list":e.editedDeal.notes,"notes-count":e.editedDeal.notesCount}})],1)],1)]},proxy:!0}])})],1)},i=[],n=a("b85c"),s=a("5530"),o=(a("99af"),a("4de4"),a("b0c0"),a("260b")),d=a("2f62"),l=a("2721"),c=a("38a1"),u=a("c0a7"),h=a("1b06"),p=a("49a1"),f=a("373c"),m=a("3368"),D=a("fac1"),S=a("7c82"),v={name:"DealEdit",components:{AppEditWrapper:l["a"],AppHeaderIcon:c["a"],AppButtonIcon:f["a"],AppLineText:h["a"],AppNumbers:p["a"],AppSelect:D["a"],AppLineDate:S["a"],AppNotesList:u["a"],PopupDeleteWrapper:m["a"]},data:function(){return{popupRemoveHidden:!0,editedDeal:"",note:"",customerID:"",worker1ID:"",worker2ID:"",worker3ID:"",worker4ID:"",worker5ID:"",dateStart:"",dateEnd:"",localWorkers:"",workersCount:0,addedWorkers:{},historyElement:{date:"[Дата: ".concat((new Date).toLocaleDateString()," Время: ").concat((new Date).toLocaleTimeString(),"]"),info:"Заявка просматривалась ",employee:{name:"Неизвестный пользователь",id:0}}}},computed:Object(s["a"])({},Object(d["c"])(["deals","employees","authEmployee","workers","customers"])),watch:{dateStart:function(){this.editedDeal.dateStart=this.dateStart,this.checkWorkers()},dateEnd:function(){this.editedDeal.dateEnd=this.dateEnd,this.checkWorkers()}},created:function(){this.SET_EMPLOYEES_FROM_LOCAL_STORAGE(),this.SET_DEALS_FROM_LOCAL_STORAGE(),this.SET_WORKERS_FROM_LOCAL_STORAGE(),this.SET_CUSTOMERS_FROM_LOCAL_STORAGE(),this.editedDeal=this.deals[this.$route.params.id],this.customerID=this.editedDeal.customer.id,this.dateStart=this.editedDeal.dateStart,this.dateEnd=this.editedDeal.dateEnd,this.addedWorkers=this.editedDeal.workers,this.workersCount=this.addedWorkers.length;try{this.worker1ID=this.editedDeal.worker.id}catch(e){}try{this.worker2ID=this.editedDeal.worker2.id}catch(e){}try{this.worker3ID=this.editedDeal.worker3.id}catch(e){}try{this.worker4ID=this.editedDeal.worker4.id}catch(e){}try{this.worker5ID=this.editedDeal.worker5.id}catch(e){}this.checkWorkers(),console.log(this.addedDeal)},methods:Object(s["a"])(Object(s["a"])({},Object(d["d"])(["SET_DEALS_FROM_SERVER","SET_DEALS_FROM_LOCAL_STORAGE","SET_EMPLOYEES_FROM_LOCAL_STORAGE","SET_WORKERS_FROM_LOCAL_STORAGE","SET_CUSTOMERS_FROM_LOCAL_STORAGE","SET_CUSTOMERS_FROM_SERVER","SET_WORKERS_FROM_SERVER"])),{},{elementCountNumber:function(e){var t,a=0,r=Object(n["a"])(this.addedWorkers);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(a++,a===e)return i}}catch(s){r.e(s)}finally{r.f()}},addMoreWorkers:function(){this.workersCount++,this.checkWorkers()},pushMoreWorkers:function(e,t){console.log(t),this.addedWorkers[t-1]=e,console.log(2,this.addedWorkers)},checkWorkers:function(){for(var e in this.localWorkers=Object(s["a"])({},this.workers),this.localWorkers)"Да"===this.localWorkers[e].fired&&delete this.localWorkers[e];if(""!==this.dateStart)try{for(var t in this.localWorkers){var a,r=Object(n["a"])(this.localWorkers[t].events);try{for(r.s();!(a=r.n()).done;){var i=a.value;void 0!==this.localWorkers[t]&&i.start<this.dateStart&&i.dealID!==this.editedDeal.id&&delete this.localWorkers[t]}}catch(u){r.e(u)}finally{r.f()}}}catch(h){}if(""!==this.dateEnd)try{for(var o in this.localWorkers){var d,l=Object(n["a"])(this.localWorkers[o].events);try{for(l.s();!(d=l.n()).done;){var c=d.value;void 0!==this.localWorkers[o]&&c.end<this.dateEnd&&c.dealID!==this.editedDeal.id&&delete this.localWorkers[o]}}catch(u){l.e(u)}finally{l.f()}}}catch(h){}},popupRemoveToggle:function(){this.popupRemoveHidden=!this.popupRemoveHidden},removeDeal:function(e){var t=this;this.popupRemoveToggle(),this.editorExit(),o["a"].database().ref("/deals/"+e.id).remove().then((function(){console.log("Заявка удалёна 🗑️"),t.SET_DEALS_FROM_SERVER()}))},editorExit:function(){this.$router.push("/deals")},saveNewNote:function(){if(this.note.length)try{this.editedDeal.notes.push("".concat((new Date).toLocaleDateString(),": ").concat(this.note))}catch(e){this.editedDeal.notes=[],this.editedDeal.notes.push("".concat((new Date).toLocaleDateString(),": ").concat(this.note))}},getNewHistoryElement:function(e){var t=this.historyElement;return t.info=e,t},saveEditedDeal:function(e){var t=this;if(this.saveNewNote(),""!==this.customerID){var a=this.customers;a[this.editedDeal.customer.id].dealStatistics=a[this.editedDeal.customer.id].dealStatistics.filter((function(e){return e.dealID!==t.editedDeal.id})),a[this.customerID].dealStatistics.push({name:this.editedDeal.name,dateStart:this.editedDeal.dateStart,dateEnd:this.editedDeal.dateEnd,dealID:this.editedDeal.id}),o["a"].database().ref("/customers/").set(a).then((function(){t.SET_CUSTOMERS_FROM_SERVER()})),this.editedDeal.customer=this.customers[this.customerID]}if(""!==this.worker1ID){try{var r=this.deals[[this.editedDeal.id]].worker.id,i=this.workers[r];i.dealStatistics=i.dealStatistics.filter((function(e){return e.dealID!==t.editedDeal.id})),i.events=i.events.filter((function(e){return e.dealID!==t.editedDeal.id})),o["a"].database().ref("/workers/"+i.id).set(i).then((function(){t.SET_WORKERS_FROM_SERVER()}))}catch(b){}var n=this.workers[this.worker1ID];n.dealStatistics.push({name:e.name,customer:e.customer,dateStart:e.dateStart,dateEnd:e.dateEnd,dealID:e.id}),n.events.push({id:Date.now(),title:e.name,start:e.dateStart,end:e.dateEnd,dealID:e.id}),o["a"].database().ref("/workers/"+n.id).set(n).then((function(){t.SET_WORKERS_FROM_SERVER()})),this.editedDeal.worker=this.workers[this.worker1ID]}if(""!==this.worker2ID){try{var s=this.deals[[this.editedDeal.id]].worker2.id,d=this.workers[s];d.dealStatistics=d.dealStatistics.filter((function(e){return e.dealID!==t.editedDeal.id})),d.events=d.events.filter((function(e){return e.dealID!==t.editedDeal.id})),o["a"].database().ref("/workers/"+d.id).set(d).then((function(){t.SET_WORKERS_FROM_SERVER()}))}catch(b){}var l=this.workers[this.worker2ID];l.dealStatistics.push({name:e.name,customer:e.customer,dateStart:e.dateStart,dateEnd:e.dateEnd,dealID:e.id}),l.events.push({id:Date.now(),title:e.name,start:e.dateStart,end:e.dateEnd,dealID:e.id}),o["a"].database().ref("/workers/"+l.id).set(l).then((function(){t.SET_WORKERS_FROM_SERVER()})),this.editedDeal.worker2=this.workers[this.worker2ID]}if(""!==this.worker3ID){try{var c=this.deals[[this.editedDeal.id]].worker3.id,u=this.workers[c];u.dealStatistics=u.dealStatistics.filter((function(e){return e.dealID!==t.editedDeal.id})),u.events=u.events.filter((function(e){return e.dealID!==t.editedDeal.id})),o["a"].database().ref("/workers/"+u.id).set(u).then((function(){t.SET_WORKERS_FROM_SERVER()}))}catch(b){}var h=this.workers[this.worker3ID];h.dealStatistics.push({name:e.name,customer:e.customer,dateStart:e.dateStart,dateEnd:e.dateEnd,dealID:e.id}),h.events.push({id:Date.now(),title:e.name,start:e.dateStart,end:e.dateEnd,dealID:e.id}),o["a"].database().ref("/workers/"+h.id).set(h).then((function(){t.SET_WORKERS_FROM_SERVER()})),this.editedDeal.worker3=this.workers[this.worker3ID]}if(""!==this.worker4ID){try{var p=this.deals[[this.editedDeal.id]].worker4.id,f=this.workers[p];f.dealStatistics=f.dealStatistics.filter((function(e){return e.dealID!==t.editedDeal.id})),f.events=f.events.filter((function(e){return e.dealID!==t.editedDeal.id})),o["a"].database().ref("/workers/"+f.id).set(f).then((function(){t.SET_WORKERS_FROM_SERVER()}))}catch(b){}var m=this.workers[this.worker4ID];m.dealStatistics.push({name:e.name,customer:e.customer,dateStart:e.dateStart,dateEnd:e.dateEnd,dealID:e.id}),m.events.push({id:Date.now(),title:e.name,start:e.dateStart,end:e.dateEnd,dealID:e.id}),o["a"].database().ref("/workers/"+m.id).set(m).then((function(){t.SET_WORKERS_FROM_SERVER()})),this.editedDeal.worker4=this.workers[this.worker4ID]}if(""!==this.worker5ID){try{var D=this.deals[[this.editedDeal.id]].worker5.id,S=this.workers[D];S.dealStatistics=S.dealStatistics.filter((function(e){return e.dealID!==t.editedDeal.id})),S.events=S.events.filter((function(e){return e.dealID!==t.editedDeal.id})),o["a"].database().ref("/workers/"+S.id).set(S).then((function(){t.SET_WORKERS_FROM_SERVER()}))}catch(b){}var v=this.workers[this.worker5ID];v.dealStatistics.push({name:e.name,customer:e.customer,dateStart:e.dateStart,dateEnd:e.dateEnd,dealID:e.id}),v.events.push({id:Date.now(),title:e.name,start:e.dateStart,end:e.dateEnd,dealID:e.id}),o["a"].database().ref("/workers/"+v.id).set(v).then((function(){t.SET_WORKERS_FROM_SERVER()})),this.editedDeal.worker5=this.workers[this.worker5ID]}e.history.push(this.getNewHistoryElement("Заявка была изменена")),o["a"].database().ref("/deals/"+e.id).set(e).then((function(){t.SET_DEALS_FROM_SERVER(),t.editorExit(),M.toast({html:"Данные сохранены!"})}))}})},b=v,k=(a("c808"),a("2877")),E=Object(k["a"])(b,r,i,!1,null,"0f89050c",null);t["default"]=E.exports},"7c82":function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"container-line-date"}},[a("input",{staticClass:"line-date",attrs:{type:"datetime-local",id:e.dateID,placeholder:e.placeholder},domProps:{value:e.value},on:{input:function(t){return e.$emit("input",t.target.value)}}}),a("label",{staticClass:"line-date-label",attrs:{for:e.dateID}},[e._v(e._s(e.label))])])},i=[],n={name:"AppLineDate",props:{dateID:String,placeholder:String,label:String,value:String}},s=n,o=(a("ef11"),a("2877")),d=Object(o["a"])(s,r,i,!1,null,"32745002",null);t["a"]=d.exports},a630:function(e,t,a){var r=a("23e7"),i=a("4df4"),n=a("1c7e"),s=!n((function(e){Array.from(e)}));r({target:"Array",stat:!0,forced:s},{from:i})},b0c0:function(e,t,a){var r=a("83ab"),i=a("9bf2").f,n=Function.prototype,s=n.toString,o=/^\s*function ([^ (]*)/,d="name";r&&!(d in n)&&i(n,d,{configurable:!0,get:function(){try{return s.call(this).match(o)[1]}catch(e){return""}}})},b85c:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));a("a4d3"),a("e01a"),a("d3b7"),a("d28b"),a("3ca3"),a("ddb0");var r=a("06c5");function i(e,t){var a="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=Object(r["a"])(e))||t&&e&&"number"===typeof e.length){a&&(e=a);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,d=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){d=!0,s=e},f:function(){try{o||null==a["return"]||a["return"]()}finally{if(d)throw s}}}}},c808:function(e,t,a){"use strict";a("005d")},d28b:function(e,t,a){var r=a("746f");r("iterator")},e01a:function(e,t,a){"use strict";var r=a("23e7"),i=a("83ab"),n=a("da84"),s=a("5135"),o=a("861d"),d=a("9bf2").f,l=a("e893"),c=n.Symbol;if(i&&"function"==typeof c&&(!("description"in c.prototype)||void 0!==c().description)){var u={},h=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),t=this instanceof h?new c(e):void 0===e?c():c(e);return""===e&&(u[t]=!0),t};l(h,c);var p=h.prototype=c.prototype;p.constructor=h;var f=p.toString,m="Symbol(test)"==String(c("test")),D=/^Symbol\((.*)\)[^)]+$/;d(p,"description",{configurable:!0,get:function(){var e=o(this)?this.valueOf():this,t=f.call(e);if(s(u,e))return"";var a=m?t.slice(7,-1):t.replace(D,"$1");return""===a?void 0:a}}),r({global:!0,forced:!0},{Symbol:h})}},ef11:function(e,t,a){"use strict";a("3254")},fac1:function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"container-select"}},[a("select",{staticClass:"app-select browser-default",attrs:{id:e.selectID},domProps:{value:e.value},on:{input:function(t){return e.$emit("input",t.target.value)},change:function(t){return e.$emit("select-change",t.target.value,e.count)}}},[e._t("default")],2),a("label",{staticClass:"select-label",attrs:{for:e.selectID}},[e._v(e._s(e.label))])])},i=[],n=(a("a9e3"),{name:"AppSelect",props:{selectID:String,label:String,value:String|Number,count:Number}}),s=n,o=(a("787e"),a("2877")),d=Object(o["a"])(s,r,i,!1,null,"bbf6f81a",null);t["a"]=d.exports}}]);
//# sourceMappingURL=chunk-672c4db1.822f1082.js.map